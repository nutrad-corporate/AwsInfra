It is Important to install and Login in AWS CLI before you deploy the code

AWS account with an EC2 instance running a Linux-based OS (Ubuntu is commonly used).
Docker installed on the EC2 instance.
Git installed on the EC2 instance.
Your FastAPI code stored in a Git repository (e.g., GitHub, GitLab).
AWS CLI set up on your local machine (if you want to interact with AWS from your terminal).

Steps:
1. Set Up AWS EC2 Instance
Launch an EC2 Instance:

In your AWS Management Console, navigate to EC2 and launch a new Ubuntu instance (or any Linux distribution you prefer).
Choose an instance type (e.g., t2.micro if you are using the free tier).
Ensure you have the correct security group that allows inbound traffic on ports 22 (SSH) and 80 (HTTP).
Key Pair: Download and keep the .pem file safe, as it will be needed to access your instance.
Connect to Your EC2 Instance: After the instance is up, connect to it using SSH.
    #connect to Linux
    ssh -i /path/to/your-key.pem ubuntu@your-ec2-public-ip
2. Install Docker and Git on EC2
On your EC2 instance, install Docker and Git.

# Update and install Docker
sudo apt-get update
sudo apt-get install -y docker.io

# Install Git
sudo apt-get install -y git

# Start Docker service and enable it on boot
sudo systemctl start docker
sudo systemctl enable docker

# Verify Docker is installed
docker --version
3. Clone Your FastAPI Application from Git
Now, clone your FastAPI repository to the EC2 instance.

# Navigate to a directory where you want to store your app
cd /path/to/your/directory

# Clone your repository
git clone https://github.com/yourusername/your-fastapi-repo.git

# Navigate to the project folder
cd your-fastapi-repo
4. Create a Dockerfile for Your FastAPI Application
In your project’s root directory (where the FastAPI app resides), create a Dockerfile. Here is an example Dockerfile for a FastAPI app:

Dockerfile
Copy
# Use official Python image
FROM python:3.9-slim

# Set the working directory in the container
WORKDIR /app

# Copy the application code into the container
COPY . /app

# Install the dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Expose the FastAPI app port (default is 8000)
EXPOSE 8000

# Command to run the FastAPI app using Uvicorn
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
Make sure your requirements.txt includes FastAPI and Uvicorn:

ini
Copy
fastapi==0.68.1
uvicorn==0.15.0
If you have other dependencies, include them in the requirements.txt.

5. Build the Docker Image
Now, build the Docker image on the EC2 instance.

bash
Copy
# Navigate to the directory containing the Dockerfile
cd /path/to/your-fastapi-app

# Build the Docker image
sudo docker build -t fastapi-app .

# Verify the image is built
sudo docker images
6. Run the FastAPI Application in Docker
Once the image is built, you can run your FastAPI app in a Docker container:

bash
Copy
# Run the container in detached mode
sudo docker run -d -p 80:8000 fastapi-app
This will start the FastAPI app and map port 8000 in the container to port 80 on the EC2 instance.

7. Verify the Application
Now, you should be able to access your FastAPI application by going to your EC2 instance's public IP in the browser:

cpp
Copy
http://<your-ec2-public-ip>
You should see your FastAPI app running. You can test it by hitting the /docs endpoint, which is automatically generated by FastAPI for API documentation.

arduino
Copy
http://<your-ec2-public-ip>/docs
8. (Optional) Set Up a Reverse Proxy with Nginx
For a production setup, it’s common to use a reverse proxy like Nginx to handle traffic more efficiently. Here’s a basic setup:

Install Nginx:
bash
Copy
# Install Nginx
sudo apt-get install nginx

# Start Nginx
sudo systemctl start nginx
Configure Nginx:
Edit the Nginx configuration to reverse proxy requests to your Docker container. Open the configuration file:

bash
Copy
sudo nano /etc/nginx/sites-available/default
Replace the content with the following:

nginx
Copy
server {
    listen 80;
    server_name your-ec2-public-ip;

    location / {
        proxy_pass http://localhost:8000;  # Proxy to the FastAPI container
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
Restart Nginx:
bash
Copy
sudo systemctl restart nginx
Now, Nginx will handle the incoming HTTP requests and forward them to the FastAPI app running in Docker on port 8000.

9. (Optional) Set Up Auto Start with Docker Restart Policies
To make sure your container restarts automatically when the server reboots, you can add a restart policy to your Docker run command:

bash
Copy
sudo docker run -d -p 80:8000 --restart unless-stopped fastapi-app
This ensures the FastAPI app restarts automatically if the server is rebooted or if the container crashes.

Summary:
Launch an EC2 instance and connect to it.
Install Docker and Git on your EC2 instance.
Clone your FastAPI app from Git.
Create a Dockerfile for your FastAPI app.
Build and run the Docker container to deploy the FastAPI app.
(Optional) Set up Nginx as a reverse proxy for production deployment.
(Optional) Set Docker restart policies to ensure automatic restarts.


